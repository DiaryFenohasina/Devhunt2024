{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { backServer } from \"@/config/axiosConfig\";\nimport { io } from \"socket.io-client\";\nexport default {\n  data() {\n    return {\n      index: -1,\n      id: parseInt(localStorage.getItem(\"id\")),\n      username: localStorage.getItem(\"username\"),\n      user: {},\n      room: [],\n      users: [],\n      connectedUsers: [],\n      newMessage: null,\n      messages: [],\n      socket: null\n    };\n  },\n  created() {\n    this.socketConnect();\n    this.getUsers();\n  },\n  beforeDestroy() {\n    this.disconnect();\n  },\n  methods: {\n    isOnline(index) {\n      const existingUser = connectedUser.find(user => user.username === status.username && user.id === status.id);\n      if (!existingUser) connectedUser.push(status);\n      return true;\n    },\n    getUsers() {\n      backServer.get(`/getUsers/${this.id}`).then(res => {\n        this.users = [...res.data.user];\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    selectUser(ind) {\n      this.user = this.users.find(user => user.id === ind);\n      this.index = ind;\n      this.joinRoom(ind);\n      this.setRoom(ind);\n      this.getMessages();\n    },\n    socketConnect() {\n      // socket : io.connect(\"http://192.168.43.19:4001\")\n      this.socket = io(\"http://127.0.0.1:3000\");\n      this.socket.emit('status', {\n        username: this.username,\n        UserId: this.id\n      });\n      this.socket.on('connectedUser', user => {\n        this.connectedUsers = [...this.connectedUsers, ...user];\n        console.log(this.connectedUsers);\n      });\n    },\n    joinRoom(anotherID) {\n      this.socket.emit('join', `${this.id}--with--${anotherID}`);\n    },\n    getMessages() {\n      this.messages = [];\n      backServer.get(`/getMessage/${this.room}`).then(res => {\n        this.messages = [...res.data.msg];\n      });\n      this.socket.on('receiveMessage', message => {\n        this.messages = [...this.messages, message];\n      });\n    },\n    sendMessage() {\n      if (!this.newMessage) return;\n      let msg = {\n        UserId: this.id,\n        msg: this.newMessage,\n        room: this.room\n      };\n      this.messages = [...this.messages, msg];\n      this.socket.emit('sendMessage', msg);\n      this.newMessage = '';\n    },\n    setRoom(id) {\n      let data = new Array(this.id, id);\n      let unique = [...new Set(data)].sort((a, b) => a < b ? -1 : 1);\n      this.room = `${unique[0]}--with--${unique[1]}`;\n    },\n    disconnect() {\n      this.socket.emit('leave', this.id);\n      this.socket.disconnect();\n    },\n    scrolled(e) {\n      console.log(e.target);\n    }\n  }\n};","map":{"version":3,"names":["backServer","io","data","index","id","parseInt","localStorage","getItem","username","user","room","users","connectedUsers","newMessage","messages","socket","created","socketConnect","getUsers","beforeDestroy","disconnect","methods","isOnline","existingUser","connectedUser","find","status","push","get","then","res","catch","err","console","log","selectUser","ind","joinRoom","setRoom","getMessages","emit","UserId","on","anotherID","msg","message","sendMessage","Array","unique","Set","sort","a","b","scrolled","e","target"],"sources":["src/views/Chat.vue"],"sourcesContent":["<template>\n  <section class=\"pt-5\">\n    <div class=\"container shadow section-sm rounded min-Height\">\n      <div class=\"row\">\n        <div class=\"col-lg-3\">\n          <ul class=\"sidenav\" v-for=\"user in users\" :key=\"user.id\">\n            <li class=\"d-flex sidelist c-type\" @click=\"selectUser(user.id)\">\n              <span :class=\"index == user.id && 'isActive'\">{{\n                user.username \n              }}</span><div v-if=\"isOnline(index)\" class=\"online\"></div>\n            </li>\n          </ul>\n        </div>\n        <div class=\"col-lg-8\">\n          <div class=\"mx-5 message\">\n\n               <!--  -->\n               <!-- USER TO CHAT -->\n              \n                <div v-if=\"user.username\">\n                  <div  class=\"rounded-5 shadow p-2 mb-4 \" style=\"height:50px\">\n                    <h4 class=\"d-flex \">{{user.username}} <span class=\"mx-4 p-0\" >connected</span></h4>  \n                  </div>\n                  <!-- CHAT MESSAGE -->\n                  <div class=\" rounded-5 mb-3 bg-light \">\n                    <ul  class=\"px-3 card-message  list-group  rounded-5 \">\n                      \n                      <li v-for=\"(message, index) in messages\" :key=\"index\" :class=\"{'mt-4' : index == 0}\" >\n                        <p class=\" message-font shadow\" :class=\"[ message.UserId == id ? 'float-end chat-l' : 'chat-r'  ]\">\n                          {{ message.msg }}\n                          <!-- <small>:{{ message.id}}</small>  -->\n                          \n                        </p>\n                      </li>\n                    </ul>\n                    <div class=\"search-wrapper  d-sm-flex\">\n                      <input id=\"search-by\" name=\"s\" type=\"email\" class=\"form-control form-control-sm\" placeholder=\"Your message here\" style=\"width:100%\" v-model=\"newMessage\" @keypress.enter=\"sendMessage\">\n                      <input type=\"submit\" class=\"btn btn-primary btn-sm\" value=\"Send\" @click=\"sendMessage\">\n                    </div>\n                  </div>\n                </div>\n\n\n              <div v-else class=\"text-center\">\n                <p  class=\"message\" >Choose an user to chat</p>\n              </div>\n             \n            </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</template>\n<script>\nimport { backServer } from \"@/config/axiosConfig\";\nimport { io }  from \"socket.io-client\"\n\n\nexport default {\n  data() {\n    return {\n      index: -1,\n      id: parseInt(localStorage.getItem(\"id\")),\n      username: localStorage.getItem(\"username\"),\n      user:{},\n      room : [],\n      users: [],\n      connectedUsers: [],\n      newMessage: null,\n      messages: [],\n      socket: null\n      \n    };\n  },\n  created() {\n    this.socketConnect()\n    this.getUsers()\n  },\n  beforeDestroy()\n  {\n      this.disconnect()\n  },\n  methods: {\n    isOnline(index)\n    {\n      const existingUser = connectedUser.find((user) => user.username === status.username && user.id === status.id)\n    \n    if(!existingUser) connectedUser.push(status)\n      return true\n    },\n    getUsers() {\n      backServer\n        .get(`/getUsers/${this.id}`)\n        .then( (res) => {\n          this.users = [...res.data.user];\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    },\n    selectUser(ind) {\n      this.user = this.users.find((user) => user.id === ind )\n      this.index = ind;\n      this.joinRoom(ind)\n      this.setRoom(ind)\n      \n      this.getMessages()\n    },\n    socketConnect(){\n      // socket : io.connect(\"http://192.168.43.19:4001\")\n      this.socket = io(\"http://127.0.0.1:3000\")\n      this.socket.emit('status',{username: this.username, UserId:this.id})\n      this.socket.on('connectedUser', (user) => {\n        this.connectedUsers = [...this.connectedUsers, ...user]\n        console.log(this.connectedUsers)\n      })\n    },\n    joinRoom(anotherID){\n      this.socket.emit('join', `${this.id}--with--${anotherID}`)\n    },\n    getMessages(){\n      this.messages = []\n      \n      backServer.get(`/getMessage/${this.room}`)\n      .then(res => {\n        this.messages = [...res.data.msg];\n\n      })\n\n      this.socket.on('receiveMessage',(message) => {\n        this.messages = [...this.messages, message]\n      })\n    },\n    sendMessage()\n    {\n      if(!this.newMessage) return\n\n      let msg = {UserId : this.id, msg: this.newMessage, room: this.room}\n\n      this.messages = [...this.messages, msg]\n            this.socket.emit('sendMessage', msg)\n      this.newMessage = ''\n\n    },\n    setRoom(id)\n    {\n      let data = new Array(this.id,id)\n      let unique = [...new Set(data)].sort((a, b) => (a < b ? -1 : 1));\n\n      this.room = `${unique[0]}--with--${unique[1]}`\n    },\n    disconnect()\n    {\n      this.socket.emit('leave', this.id)\n      this.socket.disconnect()\n    },\n    scrolled(e)\n    {\n      console.log(e.target)\n    }\n  },\n  \n};\n</script>\n<style scoped>\n  .rounded-5{\n    border-radius: 5px !important;\n  }\n  .message{\n    position: relative;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 16px;\n  }\n  .message-font{\n    font-size: 13px;\n  }\n  .min-Height{\n\n    min-height: 800px;\n    max-height: 800px;\n  }\n  .message-panel{\n    min-height: 700px;\n    max-height: 700px;\n  }\n  .card-message{\n    min-height: 560px;\n    max-height: 560px;\n    overflow-y: scroll;\n    \n  }\n  .chat-r{\n    \n    border-top-right-radius: 15px;\n    border-bottom-left-radius: 15px;\n    border-bottom-right-radius: 15px;\n    background: #cacaca;\n    padding-top: 5px;\n    padding-bottom: 5px;\n    padding-left: 10px;\n    padding-right: 10px;\n    max-width: 300px;\n    \n  }\n  .chat-l{\n    \n    border-top-left-radius: 15px;\n    border-bottom-left-radius: 15px;\n    border-bottom-right-radius: 15px;\n    background: #ffffff;\n    padding-top: 5px;\n    padding-bottom: 5px;\n    padding-left: 10px;\n    padding-right: 10px;\n    max-width: 300px;\n    \n  }\n  .online{\n    position: relative;\n    left: 15px;\n    top: 20px;\n    width: 8px;\n    height: 8px;\n    border-radius:50px;\n    background-color: rgb(3, 173, 26);\n  }\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}