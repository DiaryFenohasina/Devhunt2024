{"ast":null,"code":"import { backServer } from \"@/config/axiosConfig\";\nimport { io } from \"socket.io-client\";\nexport default {\n  data() {\n    return {\n      index: -1,\n      id: parseInt(localStorage.getItem(\"id\")),\n      username: localStorage.getItem(\"username\"),\n      panel: 'ChatBot',\n      user: {},\n      room: [],\n      users: [{\n        username: 'RAMANANTSOA Rotsiniaina'\n      }, {\n        username: 'RATSIMBAZAFY Tojoniaina Mbola Safidy'\n      }],\n      connectedUsers: [],\n      newMessage: null,\n      messages: [],\n      socket: null\n    };\n  },\n  created() {\n    // this.socketConnect()\n    // this.getUsers()\n  },\n  updated() {},\n  beforeDestroy() {\n    //   this.disconnect()\n  },\n  methods: {\n    isOnline(index) {\n      // console.log(index)\n      // console.log(this.connectedUsers)\n      const online = this.connectedUsers.find(user => user.UserId === index);\n      if (online) return true;\n      return false;\n    },\n    selectPanel(x) {\n      this.panel = x;\n    },\n    getUsers() {\n      backServer.get(`/getUsers/${this.id}`).then(res => {\n        this.users = [...res.data.user];\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    selectUser(ind) {\n      this.user = this.users.find(user => user.id === ind);\n      this.index = ind;\n      this.joinRoom(ind);\n      this.setRoom(ind);\n      this.getMessages();\n    },\n    socketConnect() {\n      // socket : io.connect(\"http://192.168.43.19:4001\")\n\n      this.socket = io(\"http://127.0.0.1:5000\");\n      this.socket.emit('status', {\n        username: this.username,\n        UserId: this.id\n      });\n      this.socket.on('connectedUser', user => {\n        this.connectedUsers = [...this.connectedUsers, ...user];\n      });\n    },\n    joinRoom(anotherID) {\n      this.socket.emit('join', `${this.id}--with--${anotherID}`);\n    },\n    getMessages() {\n      this.messages = [];\n      backServer.get(`/getMessage/${this.room}`).then(res => {\n        this.messages = [...res.data.msg];\n      });\n      this.socket.on('receiveMessage', message => {\n        this.messages = [...this.messages, message];\n      });\n    },\n    sendMessage() {\n      if (!this.newMessage) return;\n      let msg = {\n        UserId: this.id,\n        msg: this.newMessage,\n        room: this.room\n      };\n      backServer.post('/sendMessage', msg).then(res => {\n        if (res.data.message == 'message stored') {\n          this.socket.emit('sendMessage', res.data.msg);\n          this.messages = [...this.messages, res.data.msg];\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n      this.newMessage = '';\n    },\n    setRoom(id) {\n      let data = new Array(this.id, id);\n      let unique = [...new Set(data)].sort((a, b) => a < b ? -1 : 1);\n      this.room = `${unique[0]}--with--${unique[1]}`;\n    },\n    disconnect() {\n      this.socket.emit('leave', this.id);\n      this.socket.disconnect();\n    }\n  }\n};","map":{"version":3,"names":["backServer","io","data","index","id","parseInt","localStorage","getItem","username","panel","user","room","users","connectedUsers","newMessage","messages","socket","created","updated","beforeDestroy","methods","isOnline","online","find","UserId","selectPanel","x","getUsers","get","then","res","catch","err","console","log","selectUser","ind","joinRoom","setRoom","getMessages","socketConnect","emit","on","anotherID","msg","message","sendMessage","post","Array","unique","Set","sort","a","b","disconnect"],"sources":["src/views/Discussion.vue"],"sourcesContent":["<template>\r\n  <section class=\"pt-5\">\r\n    <div class=\"container shadow section-sm rounded min-Height\">\r\n      <div class=\"row\">\r\n        <div class=\"sideChat col-lg-1\">\r\n            \r\n            <ul class=\"\">\r\n                <li class=\"d-flex sidelist c-type\" @click=\"selectPanel('ChatBot')\">\r\n                    <i class=\"mb-4 ti-heart\" :class=\"panel === 'ChatBot'? 'card-icon-Tools-active' : 'card-icon-Tools'\"></i>\r\n                </li>\r\n                <li class=\"d-flex sidelist c-type\"  @click=\"selectPanel('Personne')\">\r\n                    <i class=\"mb-4 ti-heart\" :class=\"panel === 'Personne'? 'card-icon-Tools-active' : 'card-icon-Tools'\"></i>\r\n                </li>\r\n                <li class=\"d-flex sidelist c-type\" @click=\"selectPanel('Mentor')\">\r\n                    <i class=\"mb-4 ti-heart\" :class=\"panel === 'Mentor'? 'card-icon-Tools-active' : 'card-icon-Tools'\"></i>\r\n                </li>\r\n                <li class=\"d-flex sidelist c-type\" @click=\"selectPanel('Mentor')\">\r\n                    <i class=\"mb-4 ti-heart\" :class=\"panel === 'Mentor'? 'card-icon-Tools-active' : 'card-icon-Tools'\"></i>\r\n                </li>\r\n            </ul>\r\n        </div>\r\n        <div class=\"col-lg-4 px-4\">\r\n            <h3 class=\"mb-5\">Discussion</h3>\r\n            <div class=\"d-flex search-div mb-4 shadow-input \">\r\n                <input type=\"text\" class=\"ps-3 flex-grow-1 search-input me-auto text-left\">\r\n                <button type=\"submit\" class=\"search-btn pe-3\"><i class=\"ti-search h5\"></i></button>\r\n            </div>\r\n          <ul class=\"p-0\" v-for=\"user in users\" :key=\"user.id\">\r\n            <div>\r\n                <li class=\"d-flex user-li c-type\" :class=\"index == user.id && 'isActive'\" @click=\"selectUser(user.id)\">\r\n                    {{user.username}}<div v-if=\"isOnline(user.id)\" class=\"online\"></div>\r\n                </li>\r\n            </div>\r\n          </ul>\r\n        </div>\r\n        <div class=\"col-lg-7\">\r\n          <div class=\"mx-5 message\">\r\n\r\n               <!-- USER TO CHAT -->\r\n              \r\n                <div v-if=\"user.username\">\r\n                  <div  class=\"rounded-5 shadow p-2 mb-4 \" style=\"height:50px\">\r\n                    <h4 class=\"d-flex \">{{user.username}} <span class=\"mx-4 p-0\" >connected</span></h4>  \r\n                  </div>\r\n\r\n                  <!-- CHAT MESSAGE -->\r\n                  <div class=\" rounded-5 mb-3 bg-light \">\r\n                    <ul  class=\"px-3 card-message  list-group  rounded-5 \">\r\n                      \r\n                      <li v-for=\"(message, index) in messages\" :key=\"index\" :class=\"{'mt-4' : index == 0}\" >\r\n                        <p class=\" message-font shadow\" :class=\"[ message.UserId == id ? 'float-end chat-l' : 'chat-r'  ]\">\r\n                          {{ message.msg }}\r\n                          <!-- <small>:{{ message.id}}</small>  -->\r\n                          \r\n                        </p>\r\n                      </li>\r\n                    </ul>\r\n                    <div class=\"search-wrapper  d-sm-flex\">\r\n                      <input id=\"search-by\" name=\"s\" type=\"email\" class=\"form-control form-control-sm\" placeholder=\"Your message here\" style=\"width:100%\" v-model=\"newMessage\" @keypress.enter=\"sendMessage\">\r\n                      <input type=\"submit\" class=\"btn btn-primary btn-sm\" value=\"Send\" @click=\"sendMessage\">\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n\r\n              <div v-else class=\"text-center\">\r\n                <p  class=\"message\" >Choose an user to chat</p>\r\n              </div>\r\n             \r\n            </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </section>\r\n</template>\r\n<script>\r\nimport { backServer } from \"@/config/axiosConfig\";\r\nimport { io }  from \"socket.io-client\"\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      index: -1,\r\n      id: parseInt(localStorage.getItem(\"id\")),\r\n      username: localStorage.getItem(\"username\"),\r\n      panel:'ChatBot',\r\n      user:{},\r\n      room : [],\r\n      users: [\r\n        {\r\n            username: 'RAMANANTSOA Rotsiniaina'\r\n        },\r\n        {\r\n            username: 'RATSIMBAZAFY Tojoniaina Mbola Safidy'\r\n        }\r\n\r\n        ],\r\n      connectedUsers: [],\r\n      newMessage: null,\r\n      messages: [],\r\n      socket: null\r\n      \r\n    };\r\n  },\r\n  created() {\r\n    // this.socketConnect()\r\n    // this.getUsers()\r\n  },\r\n  updated(){\r\n  },  \r\n  beforeDestroy()\r\n  {\r\n    //   this.disconnect()\r\n  },\r\n  methods: {\r\n    isOnline(index)\r\n    {\r\n      // console.log(index)\r\n      // console.log(this.connectedUsers)\r\n      const online = this.connectedUsers.find((user) => user.UserId === index)\r\n      if(online) return true\r\n\r\n      return false\r\n    },\r\n    selectPanel(x)\r\n    {\r\n        this.panel = x\r\n    },\r\n    getUsers() {\r\n      backServer\r\n        .get(`/getUsers/${this.id}`)\r\n        .then( (res) => {\r\n           this.users =  [...res.data.user];\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    selectUser(ind) {\r\n      this.user = this.users.find((user) => user.id === ind )\r\n      this.index = ind;\r\n      this.joinRoom(ind)\r\n      this.setRoom(ind)\r\n      this.getMessages()\r\n      \r\n    },\r\n    socketConnect(){\r\n      \r\n      // socket : io.connect(\"http://192.168.43.19:4001\")\r\n\r\n      this.socket = io(\"http://127.0.0.1:5000\")\r\n      this.socket.emit('status',{username: this.username, UserId:this.id})\r\n      this.socket.on('connectedUser', (user) => {\r\n        this.connectedUsers = [...this.connectedUsers, ...user]\r\n      })\r\n    },\r\n    joinRoom(anotherID){\r\n      this.socket.emit('join', `${this.id}--with--${anotherID}`)\r\n    },\r\n    getMessages(){\r\n      this.messages = []\r\n      \r\n      backServer.get(`/getMessage/${this.room}`)\r\n      .then(res => {\r\n        this.messages = [...res.data.msg];\r\n\r\n      })\r\n\r\n      this.socket.on('receiveMessage',(message) => {\r\n        this.messages = [...this.messages, message]\r\n      })\r\n    },\r\n    sendMessage()\r\n    {\r\n      if(!this.newMessage) return\r\n\r\n      let msg = {UserId : this.id, msg: this.newMessage, room: this.room}\r\n        backServer.post('/sendMessage',msg)\r\n        .then(res => {\r\n          if(res.data.message == 'message stored'){\r\n            this.socket.emit('sendMessage', res.data.msg)\r\n            this.messages = [...this.messages, res.data.msg]\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err)\r\n        })\r\n      this.newMessage = ''\r\n\r\n    },\r\n    setRoom(id)\r\n    {\r\n      let data = new Array(this.id,id)\r\n      let unique = [...new Set(data)].sort((a, b) => (a < b ? -1 : 1));\r\n\r\n      this.room = `${unique[0]}--with--${unique[1]}`\r\n    },\r\n    disconnect()\r\n    {\r\n      this.socket.emit('leave', this.id)\r\n      this.socket.disconnect()\r\n    },\r\n  },\r\n  \r\n};\r\n</script>\r\n<style scoped>\r\n    .rounded-5{\r\n        border-radius: 5px !important;\r\n    }\r\n    .message{\r\n        position: relative;\r\n        top: 50%;\r\n        left: 50%;\r\n        transform: translate(-50%, -50%);\r\n        font-size: 16px;\r\n    }\r\n    .message-font{\r\n        font-size: 13px;\r\n    }\r\n    .min-Height{\r\n\r\n        min-height: 800px;\r\n        max-height: 800px;\r\n    }\r\n    .message-panel{\r\n        min-height: 700px;\r\n        max-height: 700px;\r\n    }\r\n    .card-message{\r\n        min-height: 560px;\r\n        max-height: 560px;\r\n        overflow-y: scroll;\r\n        \r\n    }\r\n    .chat-r{\r\n        \r\n        border-top-right-radius: 15px;\r\n        border-bottom-left-radius: 15px;\r\n        border-bottom-right-radius: 15px;\r\n        background: #cacaca;\r\n        padding-top: 5px;\r\n        padding-bottom: 5px;\r\n        padding-left: 10px;\r\n        padding-right: 10px;\r\n        max-width: 300px;\r\n        \r\n    }\r\n    .chat-l{\r\n        \r\n        border-top-left-radius: 15px;\r\n        border-bottom-left-radius: 15px;\r\n        border-bottom-right-radius: 15px;\r\n        background: #ffffff;\r\n        padding-top: 5px;\r\n        padding-bottom: 5px;\r\n        padding-left: 10px;\r\n        padding-right: 10px;\r\n        max-width: 300px;\r\n        \r\n    }\r\n    .online{\r\n        position: relative;\r\n        left: 15px;\r\n        top: 20px;\r\n        width: 8px;\r\n        height: 8px;\r\n        border-radius:50px;\r\n        background-color: rgb(3, 173, 26);\r\n    }\r\n    .sideChat{\r\n        border-right:1px solid #E2E2E2;\r\n    }\r\n    .active{\r\n        color: var(--baseColor);\r\n    }\r\n    li:hover{\r\n        color: var(--baseColor);\r\n    }\r\n    .card-icon-Tools-active {\r\n        background: var(--baseColor);\r\n        color: #fff;\r\n        height: 55px;\r\n        width: 60px;\r\n        line-height: 55px;\r\n        text-align: center;\r\n        font-size: 27px;\r\n        display: block;\r\n        border-radius: 12px !important;\r\n    }\r\n    .card-icon-Tools:hover {\r\n        background: var(--baseColor);\r\n        color: #fff;\r\n        height: 55px;\r\n        width: 60px;\r\n        line-height: 55px;\r\n        text-align: center;\r\n        font-size: 27px;\r\n        display: block;\r\n        border-radius: 12px !important;\r\n    }\r\n    .card-icon-Tools {\r\n        /* backgrounrgb(148, 148, 148)2E2; */\r\n        color: #5c5c5c;\r\n        height: 55px;\r\n        width: 60px;\r\n        line-height: 55px;\r\n        text-align: center;\r\n        font-size: 27px;\r\n        display: block;\r\n        border-radius: 12px !important;\r\n    }\r\n    .search-div{\r\n        /* border: 1px solid #5c5c5c; */\r\n        \r\n        height: 45px;\r\n        border-radius: 25px;\r\n        background: #ffffff;\r\n    }\r\n    .search-input{\r\n        background: transparent;\r\n        border: 0;\r\n    }\r\n    .search-input:focus{\r\n        outline: 0;\r\n    }\r\n    .search-btn{\r\n        background: transparent;\r\n        border: 0;\r\n    }\r\n</style>\r\n</template>"],"mappings":"AA4EA,SAAAA,UAAA;AACA,SAAAC,EAAA;AAEA;EACAC,KAAA;IACA;MACAC,KAAA;MACAC,EAAA,EAAAC,QAAA,CAAAC,YAAA,CAAAC,OAAA;MACAC,QAAA,EAAAF,YAAA,CAAAC,OAAA;MACAE,KAAA;MACAC,IAAA;MACAC,IAAA;MACAC,KAAA,GACA;QACAJ,QAAA;MACA,GACA;QACAA,QAAA;MACA,EAEA;MACAK,cAAA;MACAC,UAAA;MACAC,QAAA;MACAC,MAAA;IAEA;EACA;EACAC,QAAA;IACA;IACA;EAAA,CACA;EACAC,QAAA,GACA;EACAC,cAAA,EACA;IACA;EAAA,CACA;EACAC,OAAA;IACAC,SAAAlB,KAAA,EACA;MACA;MACA;MACA,MAAAmB,MAAA,QAAAT,cAAA,CAAAU,IAAA,CAAAb,IAAA,IAAAA,IAAA,CAAAc,MAAA,KAAArB,KAAA;MACA,IAAAmB,MAAA;MAEA;IACA;IACAG,YAAAC,CAAA,EACA;MACA,KAAAjB,KAAA,GAAAiB,CAAA;IACA;IACAC,SAAA;MACA3B,UAAA,CACA4B,GAAA,mBAAAxB,EAAA,IACAyB,IAAA,CAAAC,GAAA;QACA,KAAAlB,KAAA,OAAAkB,GAAA,CAAA5B,IAAA,CAAAQ,IAAA;MACA,GACAqB,KAAA,CAAAC,GAAA;QACAC,OAAA,CAAAC,GAAA,CAAAF,GAAA;MACA;IACA;IACAG,WAAAC,GAAA;MACA,KAAA1B,IAAA,QAAAE,KAAA,CAAAW,IAAA,CAAAb,IAAA,IAAAA,IAAA,CAAAN,EAAA,KAAAgC,GAAA;MACA,KAAAjC,KAAA,GAAAiC,GAAA;MACA,KAAAC,QAAA,CAAAD,GAAA;MACA,KAAAE,OAAA,CAAAF,GAAA;MACA,KAAAG,WAAA;IAEA;IACAC,cAAA;MAEA;;MAEA,KAAAxB,MAAA,GAAAf,EAAA;MACA,KAAAe,MAAA,CAAAyB,IAAA;QAAAjC,QAAA,OAAAA,QAAA;QAAAgB,MAAA,OAAApB;MAAA;MACA,KAAAY,MAAA,CAAA0B,EAAA,kBAAAhC,IAAA;QACA,KAAAG,cAAA,YAAAA,cAAA,KAAAH,IAAA;MACA;IACA;IACA2B,SAAAM,SAAA;MACA,KAAA3B,MAAA,CAAAyB,IAAA,iBAAArC,EAAA,WAAAuC,SAAA;IACA;IACAJ,YAAA;MACA,KAAAxB,QAAA;MAEAf,UAAA,CAAA4B,GAAA,qBAAAjB,IAAA,IACAkB,IAAA,CAAAC,GAAA;QACA,KAAAf,QAAA,OAAAe,GAAA,CAAA5B,IAAA,CAAA0C,GAAA;MAEA;MAEA,KAAA5B,MAAA,CAAA0B,EAAA,mBAAAG,OAAA;QACA,KAAA9B,QAAA,YAAAA,QAAA,EAAA8B,OAAA;MACA;IACA;IACAC,YAAA,EACA;MACA,UAAAhC,UAAA;MAEA,IAAA8B,GAAA;QAAApB,MAAA,OAAApB,EAAA;QAAAwC,GAAA,OAAA9B,UAAA;QAAAH,IAAA,OAAAA;MAAA;MACAX,UAAA,CAAA+C,IAAA,iBAAAH,GAAA,EACAf,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAA5B,IAAA,CAAA2C,OAAA;UACA,KAAA7B,MAAA,CAAAyB,IAAA,gBAAAX,GAAA,CAAA5B,IAAA,CAAA0C,GAAA;UACA,KAAA7B,QAAA,YAAAA,QAAA,EAAAe,GAAA,CAAA5B,IAAA,CAAA0C,GAAA;QACA;MACA,GACAb,KAAA,CAAAC,GAAA;QACAC,OAAA,CAAAC,GAAA,CAAAF,GAAA;MACA;MACA,KAAAlB,UAAA;IAEA;IACAwB,QAAAlC,EAAA,EACA;MACA,IAAAF,IAAA,OAAA8C,KAAA,MAAA5C,EAAA,EAAAA,EAAA;MACA,IAAA6C,MAAA,WAAAC,GAAA,CAAAhD,IAAA,GAAAiD,IAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAD,CAAA,GAAAC,CAAA;MAEA,KAAA1C,IAAA,MAAAsC,MAAA,cAAAA,MAAA;IACA;IACAK,WAAA,EACA;MACA,KAAAtC,MAAA,CAAAyB,IAAA,eAAArC,EAAA;MACA,KAAAY,MAAA,CAAAsC,UAAA;IACA;EACA;AAEA"},"metadata":{},"sourceType":"module","externalDependencies":[]}